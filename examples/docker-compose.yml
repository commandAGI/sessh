version: '3.8'
services:
  test-service:
    image: ubuntu:22.04
    ports:
      - "42507:22"
    environment:
      - SSH_PUBKEY=ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIe/0nGhgpND0JxszBghZatOuUc9C0eBWIsAm9hB3kJX jacob@jacob-asus-24
    command: >
      bash -c "
        apt-get update -qq &&
        apt-get install -y -qq openssh-server tmux sudo &&
        mkdir -p /var/run/sshd &&
        echo 'root:testpass' | chpasswd &&
        sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config &&
        mkdir -p /root/.ssh &&
        echo "$SSH_PUBKEY" > /root/.ssh/authorized_keys &&
        chmod 700 /root/.ssh &&
        chmod 600 /root/.ssh/authorized_keys &&
        /usr/sbin/sshd -D
      "
